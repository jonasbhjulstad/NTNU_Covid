cmake_minimum_required(VERSION 3.20)
project(NetworkViewport)
include(FetchContent)
set(CMAKE_POLICY_DEFAULT_CMP0077 NEW)
set(CMAKE_CXX_STANDARD_REQUIRED 17)
set(CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake")

find_package(Vulkan REQUIRED)
find_package(LAPACK REQUIRED)
find_package(igraph REQUIRED)
target_link_libraries(igraph::igraph INTERFACE LAPACK::LAPACK)
find_package(glfw3 3.3 REQUIRED)
find_package(glm REQUIRED)
find_package(Ktx REQUIRED)
# find_package(OpenCLHeaders REQUIRED)
# find_package(OpenCLICDLoader REQUIRED)
FetchContent_Declare(
    imgui_repo
    GIT_REPOSITORY https://github.com/ocornut/imgui
)
find_package(fmt REQUIRED)
set(CMAKE_BUILD_PARALLEL_LEVEL 8)
FetchContent_MakeAvailable(imgui_repo)
file(GLOB IMGUI_SRC "${imgui_repo_SOURCE_DIR}/*.cpp")
set(IMGUI_BACKEND "${imgui_repo_SOURCE_DIR}/backends/imgui_impl_vulkan.cpp" "${imgui_repo_SOURCE_DIR}/backends/imgui_impl_glfw.cpp")
add_library(imgui STATIC ${IMGUI_SRC} ${IMGUI_BACKEND})
target_include_directories(imgui PUBLIC ${imgui_repo_SOURCE_DIR} "${imgui_repo_SOURCE_DIR}/backends")
target_link_libraries(imgui PUBLIC Vulkan::Vulkan)
target_compile_options(imgui PRIVATE "-O3")

link_libraries(LAPACK::LAPACK)

MACRO(SUBDIRLIST result curdir)
  FILE(GLOB children RELATIVE ${curdir} ${curdir}/*)
  SET(dirlist "")
  FOREACH(child ${children})
    IF(IS_DIRECTORY ${curdir}/${child})
      LIST(APPEND dirlist ${child})
    ENDIF()
  ENDFOREACH()
  SET(${result} ${dirlist})
ENDMACRO()
SUBDIRLIST(SUBDIRS ${CMAKE_SOURCE_DIR})
foreach(subdir ${SUBDIRS})
string(TOUPPER ${subdir} subdir_upper)
set(NV_${subdir_upper}_DIR "${CMAKE_CURRENT_SOURCE_DIR}/${subdir}")
endforeach()

FetchContent_Declare(randomCL_repo
GIT_REPOSITORY https://github.com/bstatcomp/RandomCL.git
)
FetchContent_MakeAvailable(randomCL_repo)
set(NV_EXAMPLES_DATA_DIR "${CMAKE_BINARY_DIR}/examples/data/")
file(MAKE_DIRECTORY "${CMAKE_BINARY_DIR}/examples/data")
set(NV_CL_GENERATOR_DIR "${randomcl_repo_SOURCE_DIR}/generators")
set(NV_CL_KERNEL_DIR "${CMAKE_SOURCE_DIR}/OpenCL/Kernels/")
set(CL_COMPILE_DEFINITIONS "-DRANDOM_CL_GENERATOR_DIR=${RANDOM_CL_GENERATOR_DIR} -DCL_TARGET_OPENCL_VERSION=300")
add_subdirectory(Utils)
add_subdirectory(Vulkan)
add_subdirectory(ImGui)
add_subdirectory(Graph)
add_subdirectory(Menu)
add_subdirectory(Executables)
add_compile_options("-Wfatal-errors")
# add_subdirectory(examples)